<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Pilih Jenis Invoice</title>
  <style>
    body {
      font-family: 'Courier New', Courier, monospace;
      max-width: 600px;
      margin: 40px auto;
      padding: 20px;
      background: #f4f4f4;
      border: 1px solid #ccc;
      border-radius: 10px;
    }
    h2 { text-align: center; color: #1B1F3B; }
    label { display: block; margin-top: 15px; font-weight: bold; }
    input, select {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
    }
    .hidden { display: none; }
    .btn-container {
      margin-top: 30px;
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 10px;
    }
    button {
      flex: 1;
      padding: 10px;
      background-color: #1B1F3B;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover { background-color: darkred; }
    .hapus-btn { background-color: #888; }
    .kembali-btn { background-color: #555; }
  </style>
</head>
<body>

<h2>Input Jenis Invoice</h2>

<form id="jenisForm" onsubmit="return simpanJenisInvoice()">
  <label for="jenisInvoice">Jenis Invoice</label>
  <select id="jenisInvoice" required onchange="tampilkanInvoiceDP()">
    <option value="">-- Pilih Jenis --</option>
    <option value="invoice">Invoice (Cash)</option>
    <option value="dp">Invoice DP</option>
    <option value="pelunasan">Invoice Pelunasan</option>
  </select>

  <div id="inputInvoiceDP" class="hidden">
    <label for="noInvoiceDP">No. Invoice DP</label>
    <input type="text" id="noInvoiceDP" placeholder="Contoh: INV-DP/2025/001">
  </div>

  <label for="noInvoice">No. Invoice</label>
  <input type="text" id="noInvoice" required placeholder="Contoh: INV/2025/001">

  <label for="jenisTransaksi">Jenis Transaksi</label>
  <select id="jenisTransaksi" required onchange="setRekeningOtomatis()">
    <option value="">-- Pilih --</option>
    <option value="js">JS - Jasa</option>
    <option value="pg">PG - Pengadaan</option>
  </select>

  <label for="rekeningTujuan">Rekening Tujuan</label>
  <input type="text" id="rekeningTujuan" readonly>

  <label for="top">Jatuh Tempo (TOP)</label>
  <select id="top" required>
    <option value="Cash">Cash / Langsung</option>
    <option value="7">7 Hari</option>
    <option value="14">14 Hari</option>
    <option value="30">30 Hari</option>
  </select>

  <button type="submit">üíæ Simpan & Lanjut ke Invoice</button>
</form>

<hr>

<div style="margin-top: 20px;">
  <button onclick="hapusJenisInvoice()">üóëÔ∏è Hapus Data</button>
  <button onclick="kembaliKePelanggan()">üîô Kembali ke Data Pelanggan</button>
</div>

<script>
  // CEK LOGIN + HAK AKSES
  const currentUser = JSON.parse(localStorage.getItem("currentUser"));
  if (!currentUser || !["admin", "staff"].includes(currentUser.role)) {
    alert("Akses ditolak. Silakan login sebagai admin atau staff.");
    window.location.href = "dashboard.html";
  }

  function tampilkanInvoiceDP() {
    const jenis = document.getElementById("jenisInvoice").value;
    document.getElementById("inputInvoiceDP").classList.toggle("hidden", jenis !== "pelunasan");
  }

  function setRekeningOtomatis() {
    const jenis = document.getElementById("jenisTransaksi").value;
    const rekeningInput = document.getElementById("rekeningTujuan");
    rekeningInput.value = jenis === "js" ? "Mandiri - 1250015017577 a/n ALFIANTO" : "BCA - 1610366666 a/n ALFIANTO";
  }

  function simpanJenisInvoice() {
    const jenis = document.getElementById("jenisInvoice").value;
    const noInvoice = document.getElementById("noInvoice").value;
    const noInvoiceDP = document.getElementById("noInvoiceDP").value;
    const jenisTransaksi = document.getElementById("jenisTransaksi").value;
    const rekening = document.getElementById("rekeningTujuan").value;
    const top = document.getElementById("top").value;

    if (jenis === "pelunasan" && noInvoiceDP.trim() === "") {
      alert("Mohon isi No. Invoice DP untuk Invoice Pelunasan.");
      return false;
    }

    let akunDebit = "Kas";
    let akunKredit = jenisTransaksi === "js" ? "Pendapatan Jasa" : "Penjualan Barang";

    const data = {
      jenisInvoice: jenis,
      noInvoice,
      noInvoiceDP,
      jenisTransaksi,
      rekening,
      top,
      akunDebit,
      akunKredit
    };

    localStorage.setItem("jenisInvoiceTerpilih", JSON.stringify(data));
    localStorage.setItem("selectedInvoice", localStorage.getItem("selectedPelanggan"));

    const list = JSON.parse(localStorage.getItem("dataJenisInvoice")) || [];
    list.push(data);
    localStorage.setItem("dataJenisInvoice", JSON.stringify(list));

    window.location.href = "invoice.html";
    return false;
  }

  function hapusJenisInvoice() {
    if (confirm("Yakin ingin menghapus data jenis invoice yang terakhir?")) {
      localStorage.removeItem("jenisInvoiceTerpilih");
      alert("Data berhasil dihapus.");
    }
  }

  function kembaliKePelanggan() {
    window.location.href = "pelanggan.html";
  }
</script>
</body>
</html>
